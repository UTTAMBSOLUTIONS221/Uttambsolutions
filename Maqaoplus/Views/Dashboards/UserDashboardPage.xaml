<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:Maqaoplus.Helpers"
             x:Class="Maqaoplus.Views.Dashboards.UserDashboardPage"
             Title="Tenant Dashboard">

    <!-- Set the background color of the ContentPage to white -->
    <ContentPage.BackgroundColor>
        <Color>White</Color>
    </ContentPage.BackgroundColor>

    <ContentPage.Resources>
        <!-- Inverse Boolean Converter -->
        <ResourceDictionary>
            <local:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>

    <AbsoluteLayout>
        <!-- Placeholder image while data is loading -->
        <Image Source="placeholder.png"
               IsVisible="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}"
               Aspect="AspectFill"
               AbsoluteLayout.LayoutBounds="0.5, 0.5, AutoSize, AutoSize"
               AbsoluteLayout.LayoutFlags="PositionProportional"/>

        <!-- Centered loading spinner -->
        <ActivityIndicator IsRunning="{Binding IsLoading}" 
                           Color="#0a506c"
                           WidthRequest="60" 
                           HeightRequest="60"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           AbsoluteLayout.LayoutBounds="0.5, 0.5, AutoSize, AutoSize"
                           AbsoluteLayout.LayoutFlags="PositionProportional"/>

        <!-- Main content -->
        <ScrollView IsVisible="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}">
            <Grid Padding="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Tenant Information Frame -->
                <Frame Grid.Row="0" Padding="15" BackgroundColor="White" CornerRadius="10" HasShadow="False">
                    <StackLayout>
                        <Label Text="Tenant Information" FontAttributes="Bold" FontSize="24"/>
                        <Label Text="{Binding TenantData.Firstname}" FontSize="18"/>
                        <Label Text="{Binding TenantData.Lastname}" FontSize="18"/>
                    </StackLayout>
                </Frame>

                <!-- Last Meter Reading and Wallet Balance Frame -->
                <Frame Grid.Row="1" Padding="15" BackgroundColor="White" CornerRadius="10" Margin="0,10,0,0" HasShadow="False">
                    <StackLayout Orientation="Horizontal" HorizontalOptions="CenterAndExpand" Spacing="20">
                        <StackLayout>
                            <Label Text="Last Meter Reading" FontAttributes="Bold" FontSize="18"/>
                            <Label Text="{Binding TenantData.Tenantroomdata.Previousmeters}" FontSize="18"/>
                        </StackLayout>
                        <BoxView WidthRequest="1" BackgroundColor="Gray" VerticalOptions="FillAndExpand"/>
                        <StackLayout>
                            <Label Text="Wallet Balance" FontAttributes="Bold" FontSize="18"/>
                            <Label Text="{Binding TenantData.Walletbalance}" FontSize="18"/>
                        </StackLayout>
                    </StackLayout>
                </Frame>

                <!-- Tenant Room Payments Frame -->
                <Frame Grid.Row="2" Padding="15" BackgroundColor="White" CornerRadius="10" Margin="0,10,0,0" HasShadow="False">
                    <StackLayout>
                        <Label Text="Tenant Room Payments" FontAttributes="Bold" FontSize="24"/>
                        <!-- Check if payments are empty -->
                        <CollectionView ItemsSource="{Binding TenantData.Tenantroomdata.Tenantroompayments}">
                            <CollectionView.EmptyView>
                                <Label Text="No payments available" 
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       FontSize="18"
                                       TextColor="Gray"/>
                            </CollectionView.EmptyView>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <StackLayout Orientation="Horizontal" Padding="5">
                                        <Label Text="{Binding Paymentamount}" FontAttributes="Bold" VerticalOptions="Center"/>
                                        <Label Text="{Binding Monthlyrentamount}" VerticalOptions="Center" Margin="10,0"/>
                                        <Label Text="{Binding Datecreated, StringFormat='{}{0:MM/dd/yyyy}'}" VerticalOptions="Center"/>
                                    </StackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </StackLayout>
                </Frame>

                <!-- Tenant Room History Frame -->
                <Frame Grid.Row="3" Padding="15" BackgroundColor="White" CornerRadius="10" Margin="0,10,0,0" HasShadow="False">
                    <StackLayout>
                        <Label Text="Tenant Room History" FontAttributes="Bold" FontSize="24"/>
                        <!-- Check if history is empty -->
                        <CollectionView ItemsSource="{Binding TenantData.Tenantroomdata.Tenantroomhistory}">
                            <CollectionView.EmptyView>
                                <Label Text="No history available" 
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       FontSize="18"
                                       TextColor="Gray"/>
                            </CollectionView.EmptyView>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <StackLayout Orientation="Vertical" Padding="5">
                                        <Label Text="{Binding Propertyhousename}" FontAttributes="Bold"/>
                                        <Label Text="{Binding Systempropertyhousesizename}"/>
                                        <Label Text="{Binding Datecreated, StringFormat='{}{0:MM/dd/yyyy}'}"/>
                                    </StackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </StackLayout>
                </Frame>
            </Grid>
        </ScrollView>
    </AbsoluteLayout>
</ContentPage>
